#import('text', 'com.nomagic.reportwizard.tools.TextTool')
#import('hrsort', 'com.hiltonroscoe.mdreportext.Sorter')
#import('hrlang', 'com.hiltonroscoe.mdreportext.Language')
#set($packages = $array.createArray())
#set($void = $array.addCollection($packages, $Package))
#set($void = $array.addCollection($packages, $SmartPackage))
#foreach ($package in $sorter.sort($packages, "qualifiedName"))
#set($qualifiedName = $package.qualifiedName)
#set ($classList = $array.createArray())
#set ($interfaceList = $array.createArray())
#set ($enumerationList = $array.createArray())
#foreach ($element in $report.getOwnedElementsIncludingAdditional($package, true))
#if ($element.elementType == "class")
#set ($void = $classList.add($element))
#elseif ($element.elementType == "interface")
#set ($void = $interfaceList.add($element))
#elseif ($element.elementType == "enumeration")
#set ($void = $enumerationList.add($element))
#end
#end
# $package.name Glossary
#foreach ($class in $sorter.sort($classList))
#[[##]]# <a name="$class.name.replaceAll("\s+","")"></a>$class.name
#set ($docLink = " " + $class.documentation)
#foreach ($termToMatch in $hrsort.sortByLength($classList))
#set ($skipWords = $report.getStereotypeProperty($class, "glossaryEntry", "ignoreEntries"))
#if(!$list.contains($skipWords, $termToMatch.name)) 
#set ($matchedPhrases = $hrlang.findClassUsage($class.documentation.toLowerCase(), $termToMatch.name.toLowerCase(), true))
#foreach($phrase in $matchedPhrases)
#set ($docLink = $docLink.replaceAll("(?i) (\b$phrase#[[(]]#es|s)?\b)([ .,;!\)])(?![^\[]*])"," [$1](#$termToMatch.name.replaceAll(""\s+"",""""))$3"))
#end
#end
#end
$docLink.substring(1)
#set ($communities = $report.getStereotypeProperty($class, "glossaryEntry", "communities"))
#if($communities)

#foreach ($community in $communities)
\#[[#]]#$community
#end
#end
#end 
#end